

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>easymoney.money &mdash; EasyMoney 1.5.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="EasyMoney 1.5.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> EasyMoney
          

          
          </a>

          
            
            
              <div class="version">
                1.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">EasyMoney</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">Developer Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">EasyMoney</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>easymoney.money</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for easymoney.money</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Main API Functionality</span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">pycountry</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<span class="c1"># Support Tools</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">mint</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">min_max</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">closest_date</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">year_extract</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">min_max_dates</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">closest_value</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">date_format_check</span>
<span class="kn">from</span> <span class="nn">easymoney.support_tools</span> <span class="k">import</span> <span class="n">sort_range_reverse</span>

<span class="c1"># Pycountry Wrap</span>
<span class="kn">from</span> <span class="nn">easymoney.pycountry_wrap</span> <span class="k">import</span> <span class="n">PycountryWrap</span>

<span class="c1"># options_tools</span>
<span class="kn">from</span> <span class="nn">easymoney.options_tools</span> <span class="k">import</span> <span class="n">options_ranking</span>

<span class="c1"># Easy Pandas</span>
<span class="kn">from</span> <span class="nn">easymoney.easy_pandas</span> <span class="k">import</span> <span class="n">pandas_null_drop</span>
<span class="kn">from</span> <span class="nn">easymoney.easy_pandas</span> <span class="k">import</span> <span class="n">pandas_pretty_print</span>

<span class="c1"># Online Data Sources</span>
<span class="kn">from</span> <span class="nn">easymoney.sources.ecb_interface</span> <span class="k">import</span> <span class="n">ecb_xml_exchange_data</span>
<span class="kn">from</span> <span class="nn">easymoney.sources.world_bank_interface</span> <span class="k">import</span> <span class="n">world_bank_pull_wrapper</span>



<div class="viewcode-block" id="EasyPeasy"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy">[docs]</a><span class="k">class</span> <span class="nc">EasyPeasy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Tools for Monetary Information and Conversions.</span>

<span class="sd">    :param precision: number of places to round to when returning results. Defaults to 2.</span>
<span class="sd">    :type precision: ``int``</span>
<span class="sd">    :param fall_back: if True, fall back to closest possible date for which data is available. Defaults to True.</span>
<span class="sd">    :type fall_back: ``bool``</span>
<span class="sd">    :param fuzzy_match_threshold: a threshold for fuzzy matching confidence (requires the ``fuzzywuzzy`` package).</span>
<span class="sd">                                  The value must be an number between 0 and 100. The *suggested* minimum values is 85.</span>
<span class="sd">                                  This will only impact attempts to match on natural names, e.g., attempting to match</span>
<span class="sd">                                  &#39;Canada&#39; by passing &#39;Canadian&#39;. Defaults to False.</span>

<span class="sd">                                  .. warning::</span>

<span class="sd">                                        Fuzzy matching may yield inaccurate results.</span>

<span class="sd">                                        Whenever possible, use terminology *exactly* as it appears in ``options()``.</span>

<span class="sd">    :type fuzzy_threshold: ``int`` or ``float``</span>
<span class="sd">    :param data_path: alternative path to the database file(s). Defaults to none (&#39;&#39;).</span>
<span class="sd">    :type data_path: ``str``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fall_back</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fuzzy_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Initialize the ``EasyPeasy()`` class.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fall_back</span> <span class="o">=</span> <span class="n">fall_back</span>

        <span class="c1"># Check fuzzy_threshold</span>
        <span class="k">if</span> <span class="n">fuzzy_threshold</span> <span class="o">!=</span> <span class="kc">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`fuzzy_threshold` must be either `False`, a `float` or an `int`.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="n">fuzzy_threshold</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`fuzzy_threshold` be between greater than 0.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="n">fuzzy_threshold</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`fuzzy_threshold` be less than 100.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="n">fuzzy_threshold</span> <span class="o">&lt;</span> <span class="mi">85</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Low `fuzzy_threshold` values, such as </span><span class="si">%s</span><span class="s2">, may yield innaccurate results.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span> <span class="o">=</span> <span class="n">PycountryWrap</span><span class="p">(</span><span class="n">fuzzy_threshold</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pycountries_alpha_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">alpha_2</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="p">)])</span>

        <span class="c1"># CPI Dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpi_dict</span> <span class="o">=</span> <span class="n">world_bank_pull_wrapper</span><span class="p">(</span><span class="n">return_as</span><span class="o">=</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>

        <span class="c1"># Exchange Dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exchange_dict</span><span class="p">,</span> <span class="n">all_currency_codes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency_date_record</span> <span class="o">=</span> <span class="n">ecb_xml_exchange_data</span><span class="p">(</span><span class="n">return_as</span><span class="o">=</span><span class="s1">&#39;dict&#39;</span><span class="p">)</span>

        <span class="c1"># Column Order for options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_col_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RegionFull&#39;</span><span class="p">,</span> <span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha2&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha3&#39;</span><span class="p">,</span> <span class="s1">&#39;Currencies&#39;</span><span class="p">,</span> <span class="s1">&#39;InflationDates&#39;</span><span class="p">,</span> <span class="s1">&#39;ExchangeDates&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_params_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="s2">&quot;void&quot;</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="s2">&quot;void&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Check `amount` and `pretty_print` have been passed valid values.</span>

<span class="sd">        :param amount: numeric amount</span>
<span class="sd">        :type amount: ``float`` or ``int``</span>
<span class="sd">        :param pretty_print: must be a boolean</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check amount is float</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">!=</span> <span class="s2">&quot;void&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;amount must be numeric (intiger or float).&quot;</span><span class="p">)</span>

        <span class="c1"># Check pretty_print is a bool</span>
        <span class="k">if</span> <span class="n">pretty_print</span> <span class="o">!=</span> <span class="s2">&quot;void&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pretty_print</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pretty_print must be either True or False.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="EasyPeasy.region_map"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.region_map">[docs]</a>    <span class="k">def</span> <span class="nf">region_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">map_to</span><span class="o">=</span><span class="s1">&#39;alpha_2&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Map a &#39;region&#39; to any one of: ISO Alpha 2, ISO Alpha 3, it&#39;s Name or Offical Name.</span>

<span class="sd">            Examples::</span>
<span class="sd">                - ``EasyPeasy().region_map(region=&#39;CA&#39;, map_to=&#39;alpha_2&#39;)``       :math:`=` &#39;CA&#39;</span>
<span class="sd">                - ``EasyPeasy().region_map(region=&#39;Canada&#39;, map_to=&#39;alpha_3&#39;)``   :math:`=` &#39;CAN&#39;</span>

<span class="sd">        :param region: a &#39;region&#39; in the format of a ISO Alpha2, ISO Alpha3 or currency code, as well as natural name.</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param map_to: &#39;alpha_2&#39;, &#39;alpha_3&#39; &#39;name&#39; or &#39;offical_name&#39;. Defaults to &#39;alpha_2&#39;.</span>
<span class="sd">        :type map_to: ``str``</span>
<span class="sd">        :return: the desired mapping from region to ISO Alpha2.</span>
<span class="sd">        :rtype: ``str`` or ``tuple``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">map_region_to_type</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">extract_type</span><span class="o">=</span><span class="n">map_to</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_cpi_years</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Get Years for which CPI information is available for a given region.</span>

<span class="sd">        :param region: region of the form allowed by `EasyPeasy().region_map()`</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param warn: warn if data could not be obtained</span>
<span class="sd">        :type warn: ``bool``</span>
<span class="sd">        :return: list of years for which CPI information is available.</span>
<span class="sd">        :rtype: ``list``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpi_years_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpi_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">cpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpi_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
                <span class="n">cpi_years_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cpi_years_list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cpi_years_list</span>
        <span class="k">elif</span> <span class="n">warn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Could not obtain inflation (CPI) information for &#39;</span><span class="si">%s</span><span class="s2">&#39; from the</span><span class="se">\n</span><span class="s2">&quot;</span> \
                           <span class="s2">&quot;International Monetary Fund database currently cached.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">region</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_cpi_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Match region to the best possible year.</span>

<span class="sd">        :param region: region of the form allowed by `EasyPeasy().region_map()`</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param year: a year for which CPI information is desired.</span>
<span class="sd">                     Can also be one of: &#39;oldest&#39; or &#39;latest&#39;.</span>
<span class="sd">        :type year: ``int`` or ``str``</span>
<span class="sd">        :return: best matching of CPI information for the given region w.r.t. the year supplied.</span>
<span class="sd">        :rtype: ``float``, ``int`` or ``str``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize</span>
        <span class="n">fall_back_year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">natural_region_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># replace year_b if it is &#39;oldest&#39; or &#39;latest&#39;</span>
        <span class="n">available_years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpi_years</span><span class="p">(</span><span class="n">region</span><span class="p">)))</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Inflation (CPI) data for </span><span class="si">%s</span><span class="s2"> in &#39;</span><span class="si">%s</span><span class="s2">&#39; could not be obtained from the</span><span class="se">\n</span><span class="s2">&quot;</span> \
                    <span class="s2">&quot;International Monetary Fund database currently cached.&quot;</span>
        <span class="n">warn_msg</span> <span class="o">=</span> <span class="n">error_msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Falling back to </span><span class="si">%s</span><span class="s2">.&quot;</span>

        <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="s1">&#39;oldest&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">available_years</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">year</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">available_years</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">year</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fall_back</span><span class="p">:</span>
                <span class="n">natural_region_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">map_region_to_type</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
                <span class="n">fall_back_year</span> <span class="o">=</span> <span class="n">closest_value</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="n">available_years</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">warn_msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">natural_region_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fall_back_year</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">fall_back_year</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">error_msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">natural_region_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">year</span>


    <span class="k">def</span> <span class="nf">_cpi_region_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Get the Consumer Price Index (CPI) in a given region for a given year.</span>

<span class="sd">        :param region: region of the form allowed by `EasyPeasy().region_map()`</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param year: a year for which CPI information is desired.</span>
<span class="sd">                     Can also be one of: &#39;oldest&#39; or &#39;latest&#39;.</span>
<span class="sd">        :type year: ``int`` or ``str``</span>
<span class="sd">        :return: CPI for a given year.</span>
<span class="sd">        :rtype: ``float``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpi_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">year</span><span class="p">))),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_map</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s1">&#39;alpha_2&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">cpi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Could not obtain inflation information for &#39;</span><span class="si">%s</span><span class="s2">&#39; in &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>


<div class="viewcode-block" id="EasyPeasy.inflation"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.inflation">[docs]</a>    <span class="k">def</span> <span class="nf">inflation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">year_a</span><span class="p">,</span> <span class="n">year_b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_raw_cpi_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Calculator to compute the inflation rate from Consumer Price Index (CPI) information.</span>

<span class="sd">        Inflation Formula:</span>

<span class="sd">        .. math:: Inflation_{region} = \dfrac{c_{1} - c_{2}}{c_{2}} \cdot 100</span>

<span class="sd">        | :math:`where`:</span>
<span class="sd">        |   :math:`c_{1}` = CPI of the region in *year_b*.</span>
<span class="sd">        |   :math:`c_{2}` = CPI of the region in *year_a*.</span>

<span class="sd">        :param region: a region.</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param year_a: start year.</span>
<span class="sd">        :type year_a: ``int``</span>
<span class="sd">        :param year_b: end year. Defaults to None -- can only be left to this default if *return_raw_cpi_dict* is True.</span>
<span class="sd">        :type year_b: ``int``</span>
<span class="sd">        :param return_raw_cpi_dict: If True, returns the CPI information in a dict. Defaults to False.</span>
<span class="sd">        :type return_raw_cpi_dict: ``bool``</span>
<span class="sd">        :param pretty_print: if True, pretty prints the result otherwise returns the result as a float. Defaults to False.</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        :return: (a) the rate of inflation between year_a and year_h.</span>

<span class="sd">                 (b) a dictionary of CPI information with the years as keys, CPI as values.</span>
<span class="sd">        :rtype: ``float``, ``dict`` or ``NaN``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check Params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params_check</span><span class="p">(</span><span class="n">pretty_print</span><span class="o">=</span><span class="n">pretty_print</span><span class="p">)</span>

        <span class="c1"># Map Region to its alpha 2 code</span>
        <span class="n">mapped_region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_map</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="s1">&#39;alpha_2&#39;</span><span class="p">)</span>

        <span class="c1"># Set to_year</span>
        <span class="n">to_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpi_match</span><span class="p">(</span><span class="n">mapped_region</span><span class="p">,</span> <span class="n">year_b</span><span class="p">)</span> <span class="k">if</span> <span class="n">year_b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Set from_year</span>
        <span class="k">if</span> <span class="n">year_a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">from_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpi_match</span><span class="p">(</span><span class="n">mapped_region</span><span class="p">,</span> <span class="n">year_a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_a cannot be NoneType.&quot;</span><span class="p">)</span>

        <span class="c1"># Get the CPI for to_year and year_a</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpi_region_year</span><span class="p">(</span><span class="n">mapped_region</span><span class="p">,</span> <span class="n">to_year</span><span class="p">)</span> <span class="k">if</span> <span class="n">to_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpi_region_year</span><span class="p">(</span><span class="n">mapped_region</span><span class="p">,</span> <span class="n">from_year</span><span class="p">)</span>

        <span class="c1"># Return dict, if requested</span>
        <span class="k">if</span> <span class="n">return_raw_cpi_dict</span> <span class="o">!=</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">to_year</span><span class="p">,</span> <span class="n">from_year</span><span class="p">]),</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">])))</span>
            <span class="k">if</span> <span class="n">return_raw_cpi_dict</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">d</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;year_a&quot;</span><span class="p">:</span> <span class="n">from_year</span><span class="p">,</span> <span class="s2">&quot;year_b&quot;</span><span class="p">:</span> <span class="n">to_year</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">return_raw_cpi_dict</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">d</span>

        <span class="c1"># Compute the rate of Inflation (and round).</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">c1</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">c2</span><span class="p">)]))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(((</span><span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>

        <span class="c1"># Return or Pretty Print.</span>
        <span class="k">return</span> <span class="n">rate</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pretty_print</span> <span class="k">else</span> <span class="nb">print</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EasyPeasy.inflation_calculator"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.inflation_calculator">[docs]</a>    <span class="k">def</span> <span class="nf">inflation_calculator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">year_a</span><span class="p">,</span> <span class="n">year_b</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Adjusts a given amount of money for inflation.</span>

<span class="sd">        :param amount: a monetary amount.</span>
<span class="sd">        :type amount: ``float`` or ``int``</span>
<span class="sd">        :param region: a geographical region.</span>
<span class="sd">        :type region: ``str``</span>
<span class="sd">        :param year_a: start year.</span>
<span class="sd">        :type year_a: ``int``</span>
<span class="sd">        :param year_b: end year.</span>
<span class="sd">        :type year_b: ``int``</span>
<span class="sd">        :param pretty_print: if True, pretty prints the result otherwise returns the result as a float.</span>
<span class="sd">                             Defaults to False.</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        :return: :math:`amount \cdot inflation \space rate`.</span>
<span class="sd">        :rtype: ``float`` or ``NaN``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check Params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params_check</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">)</span>

        <span class="c1"># Input checking</span>
        <span class="k">if</span> <span class="n">year_a</span> <span class="o">==</span> <span class="n">year_b</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mint</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_map</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">map_to</span><span class="o">=</span><span class="s1">&#39;currency_alpha_3&#39;</span><span class="p">),</span> <span class="n">pretty_print</span><span class="p">)</span>

        <span class="c1"># Get the CPI information</span>
        <span class="n">inflation_dict</span><span class="p">,</span> <span class="n">years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflation</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">year_a</span><span class="p">,</span> <span class="n">year_b</span><span class="p">,</span> <span class="n">return_raw_cpi_dict</span><span class="o">=</span><span class="s1">&#39;complete&#39;</span><span class="p">)</span>

        <span class="c1"># Block division by zero</span>
        <span class="k">if</span> <span class="n">inflation_dict</span><span class="p">[</span><span class="n">years</span><span class="p">[</span><span class="s1">&#39;year_a&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Problem obtaining required inflation information.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

        <span class="c1"># Scale w.r.t. inflation.</span>
        <span class="n">adjusted_amount</span> <span class="o">=</span> <span class="n">inflation_dict</span><span class="p">[</span><span class="n">years</span><span class="p">[</span><span class="s1">&#39;year_b&#39;</span><span class="p">]]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">inflation_dict</span><span class="p">[</span><span class="n">years</span><span class="p">[</span><span class="s1">&#39;year_a&#39;</span><span class="p">]])</span> <span class="o">*</span> <span class="n">amount</span>

        <span class="c1"># Print or Return</span>
        <span class="k">return</span> <span class="n">mint</span><span class="p">(</span><span class="n">adjusted_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_map</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">map_to</span><span class="o">=</span><span class="s1">&#39;currency_alpha_3&#39;</span><span class="p">),</span> <span class="n">pretty_print</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_exchange_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currencies</span><span class="p">,</span> <span class="n">min_max_rslt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%Y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Get all dates for which there is data for a given list of currencies</span>

<span class="sd">        :param currencies: a list of currencies</span>
<span class="sd">        :type currencies: ``list``</span>
<span class="sd">        :param min_max_rslt: compute the earliest and latest date for which exchange rate information is available.</span>
<span class="sd">                             Defaults to False.</span>
<span class="sd">        :type min_max_rslt: ``bool``</span>
<span class="sd">        :param date_format: a data format. Defaults to &#39;%d/%m/%Y&#39;.</span>
<span class="sd">        :type date_format: ``str``</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype: 1D ``list`` or 2D ``list``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">currencies</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
                <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exchange_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">date_format</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currency_date_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># Remove None</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">dates</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">min_max_rslt</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">min_max_dates</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)))]</span>

        <span class="k">return</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">dates</span>


    <span class="k">def</span> <span class="nf">_user_currency_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency_or_region</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Converts User supplied reference to a currency into an actual ISO Alpha 3 Currency Code.</span>

<span class="sd">        :param currency_or_region: reference to a currency</span>
<span class="sd">        :type currency_or_region: ``str``</span>
<span class="sd">        :return: ISO Alpha 3 Currency Code</span>
<span class="sd">        :rtype: ``pycountry object``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">currencies</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">currency_or_region</span><span class="p">)</span><span class="o">.</span><span class="n">alpha_3</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_map</span><span class="p">(</span><span class="n">currency_or_region</span><span class="p">,</span> <span class="s2">&quot;currency_alpha_3&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_base_cur_to_lcu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Convert from a base currency (Euros) to a local currency unit, e.g., CAD.</span>

<span class="sd">        :param currency: a currency code or region</span>
<span class="sd">        :type currency: ``str``</span>
<span class="sd">        :param date: date of allowed form (currently limited to DD/MM/YYYY).</span>
<span class="sd">        :type date: ``str``</span>
<span class="sd">        :return: exchange_rate w.r.t. the Euro as a base currency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Could not obtain the exchange rate for &#39;</span><span class="si">%s</span><span class="s2">&#39; on </span><span class="si">%s</span><span class="s2"> from the</span><span class="se">\n</span><span class="s2">&quot;</span> \
                    <span class="s2">&quot;European Central Bank database currently cached.&quot;</span>
        <span class="n">warn_msg</span> <span class="o">=</span> <span class="n">error_msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Falling back to </span><span class="si">%s</span><span class="s2">.&quot;</span>

        <span class="c1"># Handle Base Currency</span>
        <span class="k">if</span> <span class="n">currency</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>

        <span class="n">available_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency_date_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">available_data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Data could not obtained for &#39;</span><span class="si">%s</span><span class="s2">&#39; from the</span><span class="se">\n</span><span class="s2">&quot;</span> \
                                 <span class="s2">&quot;European Central Bank database currently cached.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">currency</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="s1">&#39;oldest&#39;</span><span class="p">:</span>
            <span class="n">exchange_date</span> <span class="o">=</span> <span class="n">min_max_dates</span><span class="p">(</span><span class="n">available_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">date</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
            <span class="n">exchange_date</span> <span class="o">=</span> <span class="n">min_max_dates</span><span class="p">(</span><span class="n">available_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fall_back</span><span class="p">:</span>
                <span class="n">exchange_date</span> <span class="o">=</span> <span class="n">closest_date</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">available_data</span><span class="p">)</span>
                <span class="n">warn</span><span class="p">(</span><span class="n">warn_msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">exchange_date</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">exchange_date</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">date_format_check</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">from_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y&quot;</span><span class="p">):</span>
            <span class="n">exchange_date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Date Supplied. Dates must be of the form DD/MM/YYYY.&quot;</span><span class="p">)</span>

        <span class="n">exchange_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">exchange_date</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exchange_rate</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">exchange_rate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="n">exchange_date</span><span class="p">))</span>


<div class="viewcode-block" id="EasyPeasy.currency_converter"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.currency_converter">[docs]</a>    <span class="k">def</span> <span class="nf">currency_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">from_currency</span><span class="p">,</span> <span class="n">to_currency</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Function to perform currency conversion based on, **not** directly reported from, data obtained</span>
<span class="sd">        from the European Central Bank (ECB).</span>
<span class="sd">        Base Currency: EUR.</span>

<span class="sd">        **Formulae Used**</span>

<span class="sd">        Let :math:`LCU` be defined as:</span>

<span class="sd">            .. math:: LCU(\phi_{EUR}, CUR) = ExchangeRate_{\phi_{EUR}  CUR}</span>

<span class="sd">        | :math:`where`:</span>
<span class="sd">        |   :math:`CUR` is some local currency unit.</span>
<span class="sd">        |   :math:`\phi = 1`, as in the ECB data.</span>
<span class="sd">        |</span>
<span class="sd">        That is, less formally:</span>

<span class="sd">            .. math:: LCU(\phi_{EUR}, CUR) = \dfrac{x \space \space CUR}{1 \space EUR}</span>

<span class="sd">        :math:`Thus`:</span>

<span class="sd">            From :math:`CUR_{1}` to :math:`CUR_{2}`:</span>

<span class="sd">                .. math:: amount_{CUR_{2}} = \dfrac{1}{LCU(\phi_{EUR}, CUR_{1})} \cdot LCU(\phi_{EUR}, CUR_{2}) \cdot amount_{CUR_{1}}</span>

<span class="sd">        :param amount: an amount of money to be converted.</span>
<span class="sd">        :type amount: ``float`` or ``int``</span>
<span class="sd">        :param from_currency: the currency of the amount.</span>
<span class="sd">        :type from_currency: ``str``</span>
<span class="sd">        :param to_currency: the currency the amount is to be converted into.</span>
<span class="sd">        :type to_currency: ``str``</span>
<span class="sd">        :param date: date of data to perform the conversion with. Dates must be of the form: ``DD/MM/YYYY``.</span>
<span class="sd">        :type date: ``str``</span>
<span class="sd">        :param pretty_print: if True, pretty prints the table otherwise returns the table as a pandas DataFrame. Defaults to False.</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        :return: converted currency.</span>
<span class="sd">        :rtype: ``float``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check Params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params_check</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">)</span>

        <span class="c1"># to/from_currency --&gt; Alpha 3 Currency Code</span>
        <span class="n">to_currency_fn</span><span class="p">,</span> <span class="n">from_currency_fn</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_currency_input</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">to_currency</span><span class="p">,</span> <span class="n">from_currency</span><span class="p">))</span>

        <span class="c1"># Return amount unaltered if self-conversion was requested.</span>
        <span class="k">if</span> <span class="n">from_currency_fn</span> <span class="o">==</span> <span class="n">to_currency_fn</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mint</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="n">to_currency_fn</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">)</span>

        <span class="c1"># from_currency --&gt; Base Currency --&gt; to_currency</span>
        <span class="n">conversion_to_invert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_cur_to_lcu</span><span class="p">(</span><span class="n">from_currency_fn</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conversion_to_invert</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s2">&quot;Cannot converted from &#39;</span><span class="si">%s</span><span class="s2">&#39; on </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">from_currency</span><span class="p">,</span> <span class="n">date</span><span class="p">))</span>
        <span class="n">converted_amount</span> <span class="o">=</span> <span class="p">(</span><span class="n">conversion_to_invert</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_cur_to_lcu</span><span class="p">(</span><span class="n">to_currency_fn</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>

        <span class="c1"># Return results (or pretty print)</span>
        <span class="k">return</span> <span class="n">mint</span><span class="p">(</span><span class="n">converted_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="n">to_currency_fn</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">)</span></div>


<div class="viewcode-block" id="EasyPeasy.normalize"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span>
                  <span class="p">,</span> <span class="n">amount</span>
                  <span class="p">,</span> <span class="n">region</span>
                  <span class="p">,</span> <span class="n">from_year</span>
                  <span class="p">,</span> <span class="n">to_year</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span>
                  <span class="p">,</span> <span class="n">base_currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span>
                  <span class="p">,</span> <span class="n">exchange_date</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span>
                  <span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        | Convert a Nominal Amount of money to a Real Amount in the same, or another, currency.</span>
<span class="sd">        |</span>
<span class="sd">        | This requires both inflation (for *currency*) and exchange rate information (*currency* to *base_currency*).</span>
<span class="sd">          See ``options(info = &#39;all&#39;, overlap_only = True)`` for an exhaustive listing of valid values to pass to this method.</span>
<span class="sd">        |</span>
<span class="sd">        | Currency Normalization occurs in two steps:</span>
<span class="sd">        |       1. Adjust the currency for inflation, e.g., 100 (2010 :math:`CUR_{1}`)  x (2015 :math:`CUR_{1}`).</span>
<span class="sd">        |       2. Convert the adjusted amount into the *base_currency*.</span>

<span class="sd">        :param amount: a numeric amount of money.</span>
<span class="sd">        :type amount: ``float`` or ``int``</span>
<span class="sd">        :param currency: a region or currency.</span>
<span class="sd">                         Legal options: Region Name, ISO Alpha2, Alpha3 or Currency Code (see ``options()``).</span>
<span class="sd">        :type currency: ``str``</span>
<span class="sd">        :param from_year: a year. For valid values see ``options()``.</span>
<span class="sd">        :type from_year: ``int``</span>
<span class="sd">        :param to_year: a year. For valid values see ``options()``.</span>
<span class="sd">                        Defaults to &#39;latest&#39; (which will use the most recent data available).</span>
<span class="sd">        :type to_year: ``str`` or ``int``</span>
<span class="sd">        :param base_currency:  a region or currency. Legal: Region Name, ISO Alpha2, Alpha3 or Currency Code</span>
<span class="sd">                               (see ``options()``). Defaults to &#39;EUR&#39;.</span>
<span class="sd">        :type base_currency: ``str``</span>
<span class="sd">        :param pretty_print: Pretty print the result if True; return amount if False. Defaults to False.</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        :return: amount adjusted for inflation and converted into the base currency.</span>
<span class="sd">        :rtype: ``float``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check Params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params_check</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">pretty_print</span><span class="p">)</span>

        <span class="n">exchange_year</span> <span class="o">=</span> <span class="n">year_extract</span><span class="p">(</span><span class="n">exchange_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exchange_date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;oldest&#39;</span><span class="p">,</span> <span class="s1">&#39;latest&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">exchange_year</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">`exchange_date` is likely formatted improperly.&quot;</span><span class="p">)</span>

            <span class="c1"># Check delta between `to_year` and `exchange_date`.</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">to_year</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">exchange_year</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># note, this doesn&#39;t currently handle oldest v. latest.</span>
                <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The year for which the input amount is being adjusted</span><span class="se">\n</span><span class="s2">&quot;</span>
                     <span class="s2">&quot;for inflation is </span><span class="si">%s</span><span class="s2">, whereas the exchange rate year is </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">to_year</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">exchange_year</span><span class="p">)))</span>

        <span class="c1"># Adjust input for inflation</span>
        <span class="n">real_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflation_calculator</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">year_a</span><span class="o">=</span><span class="n">from_year</span><span class="p">,</span> <span class="n">year_b</span><span class="o">=</span><span class="n">to_year</span><span class="p">)</span>

        <span class="c1"># Compute Exchange</span>
        <span class="n">normalize_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency_converter</span><span class="p">(</span><span class="n">real_amount</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">base_currency</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">exchange_date</span><span class="p">)</span>

        <span class="c1"># Return results (or pretty print)</span>
        <span class="k">return</span> <span class="n">mint</span><span class="p">(</span><span class="n">normalize_amount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_currency_input</span><span class="p">(</span><span class="n">base_currency</span><span class="p">),</span> <span class="n">pretty_print</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_options_info_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rformat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Error Messages for invalid information requests.</span>

<span class="sd">        :param rformat: one of: &#39;list&#39; or &#39;table&#39;.</span>
<span class="sd">        :type rformat: ``str``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_error_msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid Information Request.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                            <span class="s2">&quot;Please supply:</span><span class="se">\n</span><span class="s2">&quot;</span> \
                            <span class="s2">&quot; - &#39;exchange&#39; to `info` for a </span><span class="si">%s</span><span class="s2"> of currencies for which exchange rates are available.</span><span class="se">\n</span><span class="s2">&quot;</span> \
                            <span class="s2">&quot; - &#39;inflation&#39; to `info` for a </span><span class="si">%s</span><span class="s2"> of countries for which inflation information is available.&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">rformat</span><span class="p">,</span> <span class="n">rformat</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rformat</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">append</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">To see a complete summary, please set `rformat` equal to &#39;table&#39; and set `info` equal to &#39;all&#39;.&quot;</span>
        <span class="k">elif</span> <span class="n">rformat</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span>
            <span class="n">append</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - &#39;all&#39; to `info` for a complete summary of available data.&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">options_error_msg</span> <span class="o">+</span> <span class="n">append</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_options_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">table_overlap_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">range_table_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Tool to Generate Information for ``options()`` in table form.</span>

<span class="sd">        :param info: &#39;exchange&#39;, &#39;inflation&#39; or &#39;all&#39; (&#39;all&#39; requires rformat is set to &#39;table&#39;).</span>
<span class="sd">        :type info: ``str``</span>
<span class="sd">        :param table_overlap_only:</span>
<span class="sd">        :param table_overlap_only: when info is set to &#39;all&#39;, keep only those rows for which exchange rate and inflation data overlap.</span>
<span class="sd">        :type table_overlap_only: ``bool``</span>
<span class="sd">        :param range_table_dates: if True, only report the minimum and maximum date for which data is available;</span>
<span class="sd">                              if False, all dates for which data is available will be reported. Defaults to True.</span>
<span class="sd">        :type range_table_dates: ``bool``</span>
<span class="sd">        :return: dataframe summarizing databases currently cached by ``EasyPeasy()``.</span>
<span class="sd">        :rtype: ``Pandas DataFrame``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: does not currently handle currency transitions</span>

        <span class="c1"># Use CurrencyRelationshipsDB as Base</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">alpha2_currency_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pycountries_alpha_2</span><span class="p">]</span>
        <span class="n">options_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span> <span class="p">:</span> <span class="s2">&quot;Alpha2&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">:</span> <span class="s2">&quot;Currencies&quot;</span><span class="p">})</span>

        <span class="c1"># Add Names</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">map_region_to_type</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Alpha2&#39;</span><span class="p">])]</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;RegionFull&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">map_region_to_type</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;official_name&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Alpha2&#39;</span><span class="p">])]</span>

        <span class="c1"># Add Alpha3</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Alpha3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pycountry_wrap</span><span class="o">.</span><span class="n">map_region_to_type</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;alpha_3&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Alpha2&#39;</span><span class="p">])]</span>

        <span class="c1"># Map available Inflation Data onto this Base</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;InflationDates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Alpha2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
              <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sort_range_reverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cpi_years</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;reverse&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">range_table_dates</span> <span class="k">else</span> <span class="s1">&#39;range&#39;</span><span class="p">)),</span> <span class="s1">&#39;ignore&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Map available Exchange Rate Data onto this Base</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;ExchangeDates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;Currencies&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exchange_dates</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">min_max_rslt</span><span class="o">=</span><span class="n">range_table_dates</span><span class="p">),</span> <span class="n">na_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Fill NaNs</span>
        <span class="n">options_df</span> <span class="o">=</span> <span class="n">options_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>

        <span class="c1"># Weight Rows by Completeness; Sort by Data Overlap and Alpha2 Code</span>
        <span class="n">options_df</span><span class="p">[</span><span class="s1">&#39;TempRanking&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">options_ranking</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;InflationDates&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;ExchangeDates&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">options_df</span> <span class="o">=</span> <span class="n">options_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;TempRanking&#39;</span><span class="p">,</span> <span class="s1">&#39;Alpha2&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">table_overlap_only</span> <span class="ow">and</span> <span class="n">info</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">options_df</span> <span class="o">=</span> <span class="n">pandas_null_drop</span><span class="p">(</span><span class="n">options_df</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;InflationDates&#39;</span><span class="p">,</span> <span class="s1">&#39;ExchangeDates&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">table_overlap_only</span> <span class="ow">and</span> <span class="n">info</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`table_overlap_only` can only take effect if `info` is equal to &#39;all&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Subset</span>
        <span class="n">col_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_col_order</span>
        <span class="k">if</span> <span class="n">info</span> <span class="o">==</span> <span class="s1">&#39;exchange&#39;</span><span class="p">:</span>
            <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_col_order</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;InflationDates&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">info</span> <span class="o">==</span> <span class="s1">&#39;inflation&#39;</span><span class="p">:</span>
            <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_col_order</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;ExchangeDates&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">info</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options_info_error</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">options_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;TempRanking&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">col_order</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_options_lists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Tool to Generate Information for ``options()`` in list form.</span>

<span class="sd">        :param info: &#39;exchange&#39;, &#39;inflation&#39; or &#39;all&#39; (&#39;all&#39; requires rformat is set to &#39;table&#39;).</span>
<span class="sd">        :type info: ``str``</span>
<span class="sd">        :return: list of requested information.</span>
<span class="sd">        :rtype: ``list``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;inflation&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options_info_error</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_dict</span> <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;exchange&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpi_dict</span>

        <span class="n">full</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">full</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]))</span>


<div class="viewcode-block" id="EasyPeasy.options"><a class="viewcode-back" href="../../source/easymoney.html#easymoney.money.EasyPeasy.options">[docs]</a>    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">rformat</span><span class="o">=</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">table_overlap_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">range_table_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        An easy interface to explore all of the terminology EasyPeasy understands</span>
<span class="sd">        as well the dates for which data is available.</span>

<span class="sd">        :param info: &#39;exchange&#39;, &#39;inflation&#39; or &#39;all&#39; (&#39;all&#39; requires rformat is set to &#39;table&#39;).</span>
<span class="sd">        :type info: ``str``</span>
<span class="sd">        :param rformat: &#39;table&#39; for a table or &#39;list&#39; for just the currency codes, alone. Defaults to &#39;table&#39;.</span>
<span class="sd">        :type rformat: ``str``</span>
<span class="sd">        :param pretty_print: if True, prints the list or table. If False, returns the list or table (as a Pandas DataFrame).</span>
<span class="sd">                             Defaults to True.</span>
<span class="sd">        :type pretty_print: ``bool``</span>
<span class="sd">        :param table_overlap_only: when info is set to &#39;all&#39;, keep only those rows for which exchange rate and inflation data overlap.</span>
<span class="sd">        :type table_overlap_only: ``bool``</span>
<span class="sd">        :param range_table_dates: if True, only report the minimum and maximum date for which data is available;</span>
<span class="sd">                              if False, all dates for which data is available will be reported. Defaults to True.</span>
<span class="sd">        :type range_table_dates: ``bool``</span>
<span class="sd">        :return: DataFrame of Currency Information `EasyPeasy()` Understands.</span>
<span class="sd">        :rtype: ``Pandas DataFrame``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pretty_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rformat</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options_lists</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">request</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pretty_print</span> <span class="k">else</span> <span class="n">pprint</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rformat</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options_table</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">table_overlap_only</span><span class="p">,</span> <span class="n">range_table_dates</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                <span class="n">pretty_df</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;RegionFull&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">pretty_df</span><span class="p">[</span><span class="s1">&#39;Currencies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pretty_df</span><span class="p">[</span><span class="s1">&#39;Currencies&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
                <span class="n">pandas_pretty_print</span><span class="p">(</span><span class="n">pretty_df</span><span class="p">,</span> <span class="n">col_align</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Region&#39;</span> <span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`rformat` must be one of:</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot; - &#39;list&#39;, for a list of the requested information.</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="s2">&quot; - &#39;table&#39;, for a table (dataframe) of the requested information.&quot;</span><span class="p">)</span></div></div>

































</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Tariq A. Hassan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.5.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>